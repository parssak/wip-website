(this["webpackJsonpmixbot-cra"]=this["webpackJsonpmixbot-cra"]||[]).push([[0],{22:function(e,t,a){},31:function(e,t,a){e.exports=a(60)},36:function(e,t,a){},38:function(e,t,a){},57:function(e,t,a){},60:function(e,t,a){"use strict";a.r(t);var n=a(0),s=a.n(n),r=a(25),o=a.n(r),i=(a(36),a(1)),c=a.n(i),u=a(3),l=a(2);a(38);function f(e){var t=e.details,a=e.dontCare;return s.a.createElement("div",{className:"update-mixbot"},s.a.createElement("h1",null,"There is a new version of MixBot available!"),s.a.createElement("div",{className:"update-content"},t&&t.map((function(e,t){return s.a.createElement("div",{className:"card",key:e.id+"details",style:{flexGrow:1}},s.a.createElement("p",{key:e.id+"text details"},e))}))),s.a.createElement("div",{className:"buttons"},s.a.createElement("button",{onClick:function(){window.open("https://www.parssak.com")}},"Download Here"),s.a.createElement("button",{className:"nothanks",onClick:function(){a()}},"No Thanks")))}var p,h=a(7),d=a(8),m=a(11),g=a.n(m),v=function(){var e=Object(u.a)(c.a.mark((function e(t,a){var n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g.a.get("https://stark-reef-17924.herokuapp.com/"+t,{params:{data:a}});case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),b=function(){function e(){Object(h.a)(this,e)}return Object(d.a)(e,[{key:"checkForUpdate",value:function(){var e=Object(u.a)(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v("checkUpdate",{data:t});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"addToAnalysis",value:function(){var e=Object(u.a)(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v("addAnalysis",{data:t});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"addToWhitelist",value:function(){var e=Object(u.a)(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v("addWhitelist",{data:t});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"addToReference",value:function(){var e=Object(u.a)(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v("addReference",{data:t});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"checkReferenceDB",value:function(){var e=Object(u.a)(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v("checkReference",{data:t});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"checkAnalysisDB",value:function(){var e=Object(u.a)(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v("checkAnalysis",{data:t});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"checkWhitelistDB",value:function(){var e=Object(u.a)(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v("checkWhitelist",{data:t});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getPlaylist",value:function(){var e=Object(u.a)(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v("playlist",{playlistID:t});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getSpotifyAnalysis",value:function(){var e=Object(u.a)(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v("analysis",{songID:t});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getYoutubeList",value:function(){var e=Object(u.a)(c.a.mark((function e(t,a){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v("search-yt",{songName:t,duration_ms:a});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"getAudioPath",value:function(){var e=Object(u.a)(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v("getMP3",{id:t});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getAudioLoaded",value:function(){var e=Object(u.a)(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v("getLoaded",{id:t});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),y=a(10),w=a(26),k=new b,O="",S=!1;function E(e){var t=e.trackDetail,a=e.foundSong,s=e.cantFind,r=e.newThought,o=Object(n.useState)(""),i=Object(l.a)(o,2),f=i[0],h=i[1],d=Object(n.useState)(""),m=Object(l.a)(d,2),g=m[0],v=m[1];function b(){var e=[];return t.artists.forEach((function(t){var a=t.name;a&&e.push(a)})),t.name+" by "+e[0]}function y(e){return w.apply(this,arguments)}function w(){return(w=Object(u.a)(c.a.mark((function e(a){var n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,k.getYoutubeList(a,t.duration_ms);case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function E(e){return x.apply(this,arguments)}function x(){return(x=Object(u.a)(c.a.mark((function e(a){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:y(a).then(function(){var e=Object(u.a)(c.a.mark((function e(a){var n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!a.data){e.next=4;break}h(a.data),e.next=8;break;case 4:return n={songID:t.id,songName:t.name,songArtists:t.artists,expectedDuration:t.duration_ms},e.next=7,k.addToWhitelist(n);case 7:s(!1);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function N(){return(N=Object(u.a)(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:k.getAudioPath(t).then((function(e){v("https://stark-reef-17924.herokuapp.com/"+t+".mp3")}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function A(){clearInterval(p),p=null,v(""),a(t.name,t.artists,t.duration_ms,g,t.id,t.album.images[1],f,S)}return Object(n.useEffect)((function(){f&&""===O&&(O=f,function(e){N.apply(this,arguments)}(f))}),[f]),Object(n.useEffect)((function(){function e(){return(e=Object(u.a)(c.a.mark((function e(){var a,n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,k.checkReferenceDB(t.id);case 2:if(a=e.sent,O="",""!==a){e.next=18;break}return e.next=7,k.checkWhitelistDB(t.id);case 7:if(""!==e.sent){e.next=15;break}return S=!1,n=b(),e.next=13,E(n);case 13:e.next=16;break;case 15:s(!0);case 16:e.next=20;break;case 18:S=!0,h(a.videoID);case 20:case"end":return e.stop()}}),e)})))).apply(this,arguments)}t&&function(){e.apply(this,arguments)}()}),[t]),Object(n.useEffect)((function(){""===g||p?console.log("didn't call the interval",g,p):(console.log("fetching",t),r("Getting ".concat(t.name," by ").concat(t.artists[0].name),ge.NEUTRAL),p=setInterval(Object(u.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j(f);case 2:e.sent&&A();case 4:case"end":return e.stop()}}),e)}))),7e3))}),[g]),null}function j(e){return x.apply(this,arguments)}function x(){return(x=Object(u.a)(c.a.mark((function e(t){var a;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,k.getAudioLoaded(t);case 2:return a=e.sent,e.abrupt("return",a.isLoaded);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var N=1,A=2,P=3,T=4,C=5,I=function(){function e(){Object(h.a)(this,e),console.log("new analyzer created")}return Object(d.a)(e,[{key:"analyzeSong",value:function(e){var t=this;console.log("analyzing data.");var a=[],n=e.sections,s=e.track.loudness,r=e.bars,o=[],i=[],c=r[0].duration,u=0;r.forEach((function(e){e.confidence>u&&(c=e.duration,u=e.confidence)}));for(var l=2*c,f=e.track.duration,p=f/l,h=0;h<=p;h++)i.push(h*l);for(var d=[],m=f/c,g=0;g<=m;g++)d.push(g*c);for(var v=0;v<d.length-1;v++){var b={start:d[v],end:d[v+1],drag:!1,resize:!1,computed:{}};a.push(b)}n.forEach((function(e){var a=A,n=!1,r=(e.loudness-s)/s;0===o.length&&(a=T),r<0&&(a=N);var c=0;o.length>0&&(c=o[o.length-1].computed.comparisonLoudness-r,o[o.length-1].sectionType===N&&(a=a===N?C:P));var u=e.start,f=e.start+e.duration,p=t.closest(f,i),h=t.closest(u,i),d=h-u,m=p-f,g=(((f=p)-(u=h))/l).toPrecision(2);g%1&&(n=!0);var v="rgba(162,254,231,0.3)";switch(a){case"":break;case T:v="rgba(50,255,155,0.3)",n&&(v="rgba(100,255,55,0.3)");break;case N:v="rgba(237,61,155,0.3)",n&&(v="rgba(255,31,105,0.3)");break;case P:v="rgba(123,215,255,0.3)",n&&(v="rgba(50,150,255,0.3)");break;case C:v="rgba(34,1,255,0.2)",n&&(v="rgba(0,255,150,0.2)")}var b=!1;a!==N&&(r>0&&r<.1||a===T)&&(v="rgba(218, 165, 32,0.3)",b=!0),v="rgba(0, 0, 0, 0)";var y={sectionType:a,begin:u,endpoint:f,computed:{comparisonLoudness:r,differential:c,sectionConfidence:e.confidence,conformedBegin:!1,conformedEnd:!1,oBegin:d,oEnd:m},sizeComparison:g,is32:n,sectionColor:v,goodForMix:b};o.push(y)}));var y=0;return o.length>2&&(4===o[0].sizeComparison||2===o[0].sizeComparison&&2===o[1].sizeComparison?y=0:2===o[0].sizeComparison&&o[1].sizeComparison%4===0&&(y=o[0].endpoint)),{songSections:o,bars:d,startPos:y,tempo:e.track.tempo,loudness:s,songKey:e.track.key}}},{key:"closest",value:function(e,t){var a=1e14,n=1e14;return t.forEach((function(t){var s=Math.abs(e-t);Math.abs(e-t)<n&&(n=s,a=t)})),a}}]),e}(),F=1,D=2,R=3,M=null,B=null,L=new b,V=new I;function U(){switch(M){case F:return"Euro House Mix";case R:return"Tech House Mix";case D:return"Chill House Mix"}}var z=function(e){var t=e.addToQueue,a=e.addMoreSongs,r=e.newThought,o=e.mixChosen,i=Object(n.useState)({selectedPlaylist:null,listOfPlaylistFromAPI:[]}),f=Object(l.a)(i,2),p=f[0],h=f[1],d=Object(n.useState)({selectedTrack:"",listOfTracksFromAPI:[]}),m=Object(l.a)(d,2),g=m[0],v=m[1],b=Object(n.useState)(null),w=Object(l.a)(b,2),k=w[0],O=w[1],S=Object(n.useState)(!1),j=Object(l.a)(S,2),x=j[0],N=j[1];function A(e){1===e?(M=F,B=Math.random()>.5?"2818tC1Ba59cftJJqjWKZi":"1fWDDXepy50hFXLhwGR5xP"):2===e?(M=D,B=Math.random()>.5?"52yAobXW9CokfKnLhe3C8Z":"6el7EnAXJJ2kvnoBDvWXvk"):(M=R,B="7HRYveKYzLJFqb1PTJejoL"),h({selectedPlaylist:B}),N(!0)}var P=Object(n.useCallback)((function(e){var t=e[Math.floor(Math.random()*(e.length-1))];if(!he(t.track.id)){var a=Object(y.a)(g.listOfTracksFromAPI).filter((function(e){return e.id===t.id}));O(a[0])}}));function T(){return(T=Object(u.a)(c.a.mark((function e(t,a,n,s,r,o,i,u){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(he(r)){e.next=5;break}return e.next=3,C(r,t,a,n,s,o,i,u);case 3:e.next=6;break;case 5:O(null);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}Object(n.useEffect)((function(){console.log("[effect] track selector"),g.listOfTracksFromAPI.length>0?null==k&&a?(console.log("FINDING ANOTHER SONG"),P(g.listOfTracksFromAPI)):console.log("did not call to choose more songs",k,a):console.log("flopped!!!!!!")}),[g,k,a,P]);var C=function(){var e=Object(u.a)(c.a.mark((function e(a,n,s,r,o,i,u,l){var f,p;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L.checkAnalysisDB(a);case 2:if(f=e.sent){e.next=10;break}return e.next=6,L.getSpotifyAnalysis(a);case 6:p=e.sent,f=V.analyzeSong(p.body),f={songID:a,songName:n,analysis:f};case 10:t(n,s,r,o,f,i,a,u,l),O(null);case 12:case"end":return e.stop()}}),e)})));return function(t,a,n,s,r,o,i,c){return e.apply(this,arguments)}}();return s.a.createElement("div",{className:"selector-wrapper"},x?s.a.createElement("h1",null,U()):s.a.createElement("h1",null,"Select a mix"),s.a.createElement("div",{className:"playlist-select"},0===me()&&s.a.createElement("button",{onClick:function(){return A(1)}},"EURO HOUSE"),0===me()&&s.a.createElement("button",{onClick:function(){return A(2)}},"CHILL HOUSE"),0===me()&&s.a.createElement("button",{onClick:function(){return A(3)}},"TECH HOUSE")),s.a.createElement("form",{onSubmit:function(e){e.preventDefault(),L.getPlaylist(p.selectedPlaylist).then((function(e){console.log("got tracks",e),v({selectedTrack:g.selectedTrack,listOfTracksFromAPI:e}),o(U())}))}},x&&0===me()&&s.a.createElement("button",{className:"begin-mix"},"Begin mix"),s.a.createElement("div",{style:{marginTop:"4em"}},s.a.createElement(E,{trackDetail:k,foundSong:function(e,t,a,n,s,r,o,i){return T.apply(this,arguments)},cantFind:function(e){if(!e){var t="Unable to add "+k.name;r(t,ge.FAILURE)}O(null)},newThought:r}))))},q=a(5),G=a(30),W=a(29),H=a(12),X=a.n(H),K=a(27),J=a.n(K),Y=(a(57),{cache:"default",mode:"cors",method:"GET",credentials:"same-origin",redirect:"follow",referrer:"client",headers:[{"Access-Control-Allow-Origin":"*"}]}),Q=!1,_=function(e){Object(G.a)(a,e);var t=Object(W.a)(a);function a(e){var n;return Object(h.a)(this,a),(n=t.call(this,e)).state={pos:0,locked:!1,scheduledDemise:!1,currSec:"NOT PLAYING",playing:!1,trackName:n.props.songName,trackArtist:n.props.songArtist,audioCtx:new AudioContext,audioSettings:{gain:1,lowpassF:11e3,highpassF:0,high:1,mid:1,low:1,playbackRate:n.props.playbackRate},currSectionAnalysis:{begin:NaN,endpoint:NaN,comparisonLoudness:NaN,differential:NaN,sectionConfidence:NaN,conformedBegin:NaN,conformedEnd:NaN,oBegin:NaN,oEnd:NaN,sectionColor:"rgb(255,255,255)",goodForMix:!1,isBest:!1},startingPos:0},n.waveSurferOptions={container:"#".concat(n.props.waveformID),waveColor:"#ffffff",cursorColor:"tomato",hideScrollbar:!0,normalize:!0,height:70,barWidth:1,barHeight:.5,barRadius:2,plugins:[J.a.create()],xhr:Y},n.lastAdjustTime=0,n.synced=!1,n.fadingOut=!1,n.fadingIn=!1,n.totalOffset=0,n.numSuccessful=0,n.numDropsPassed=0,n.playPause=n.playPause.bind(Object(q.a)(n)),n.fadeOutSong=n.fadeOutSong.bind(Object(q.a)(n)),n.changeFilter=n.changeFilter.bind(Object(q.a)(n)),n.changeGain=n.changeGain.bind(Object(q.a)(n)),n.reconnectAudio=n.reconnectAudio.bind(Object(q.a)(n)),n.handlePosChange=n.handlePosChange.bind(Object(q.a)(n)),n.takeOutSong=n.takeOutSong.bind(Object(q.a)(n)),n.normalizePlayback=n.normalizePlayback.bind(Object(q.a)(n)),n}return Object(d.a)(a,[{key:"componentDidMount",value:function(){this.waveform=X.a.create(this.waveSurferOptions),this.waveform.on("error",(function(e){console.error(e)})),this.waveform.load(this.props.thisSong),this.waveform.setPlaybackRate(this.props.playbackRate),this.reconnectAudio()}},{key:"componentDidUpdate",value:function(e){if(this.waveform.getVolume()<this.props.recommendedVolume&&!this.fadingIn&&this.fadingOut,this.props.thisSong!==e.thisSong){this.waveform.pause(),this.synced=!1,this.numSuccessful=0,this.totalOffset=0,this.fadingOut=!1,this.fadingIn=!1,this.numDropsPassed=0,this.waveform.destroy(),this.waveform=X.a.create(this.waveSurferOptions),this.waveform.on("error",(function(e){}));var t=new Audio(this.props.thisSong);this.waveform.load(t.src),this.waveform.setPlaybackRate(this.props.playbackRate),this.reconnectAudio()}if("suspended"!==this.state.audioCtx.state&&this.props.play!==this.waveform.isPlaying()&&(this.props.play?this.playPause():this.waveform.pause()),this.props.shouldSync||(this.synced=!0,this.normalizePlayback()),Math.abs(this.props.offset)<.1&&this.waveform.isPlaying()&&(this.numSuccessful++,Math.abs(this.props.offset)<.05&&this.numSuccessful++,this.numSuccessful>=3&&(this.synced=!0)),this.props.offset!==e.offset&&this.waveform.getCurrentTime()-this.lastAdjustTime>5&&Math.abs(this.props.offset)>=.05&&!this.synced&&(this.numSuccessful=0,this.waveform.getCurrentTime()+this.props.offset>1&&0!=this.props.offset)){this.lastAdjustTime=this.waveform.getCurrentTime();var a=this.props.offset;this.totalOffset=this.props.offset;this.waveform.getCurrentTime(),this.props.offset;this.waveform.pause(),this.waveform.skip(a),this.waveform.playPause()}this.props.shouldRemove&&!this.fadingOut&&!this.shouldSync&&this.props.otherPlaying&&this.takeOutSong(),this.props.masterPlay!==e.masterPlay&&(this.props.masterPlay?(this.waveform.pause(),Q=!0):this.waveform.isPlaying()!==this.props.play?this.waveform.play():Q=!1)}},{key:"normalizePlayback",value:function(){if(1!==this.waveform.getPlaybackRate()){var e=Z(this.waveform.getPlaybackRate(),1,.1,this.props.deckName);isFinite(e)&&this.waveform.setVolume(e),Math.abs(1-this.waveform.getPlaybackRate())<.1?this.waveform.setPlaybackRate(1):this.normalizePlayback()}}},{key:"reconnectAudio",value:function(){var e=this,t=this.waveform.backend.ac.createBiquadFilter();t.frequency.value=this.state.audioSettings.lowpassF||11e3,t.type="lowpass",t.Q.value=5,this.setState({lowpassNode:t});var a=this.waveform.backend.ac.createBiquadFilter();a.frequency.value=this.state.audioSettings.highpassF||0,a.type="highpass",a.Q.value=5,this.setState({highpassNode:a});var n=this.waveform.backend.ac.createGain();if(n.value=this.state.audioSettings.gain||.01,this.setState({gainNode:n}),this.waveform.backend.setFilter(t,a),"NOTFOUND"!==this.props.songAnalysis){var s=this.props.songAnalysis.analysis.songSections;s||(console.log("error!!"),console.log(this.props)),s||console.log("NO ANALYZED!!",this.props),s.forEach((function(t){var a={start:t.begin,end:t.endpoint,attributes:t.computed,data:t,color:t.sectionColor,drag:!1,resize:!1};e.waveform.addRegion(a)})),this.props.songAnalysis.analysis.bars.forEach((function(t){e.waveform.addRegion(t)})),this.setState({startingPos:this.props.songAnalysis.startPos})}this.waveform.on("region-in",(function(t){e.props.hitBar(),t.data.computed.differential<0&&e.props.otherReady&&e.waveform.getCurrentTime()/e.waveform.getDuration()>.4&&e.props.playOtherTrack(),void 0!==t.data.sectionType&&t.data.sectionType===N&&e.numDropsPassed++})),this.waveform.on("region-out",(function(t){var a=t.data,n=a.computed;n?(e.setState({currSec:a.sectionType,currSectionAnalysis:{begin:a.begin,endpoint:a.endpoint,comparisonLoudness:n.comparisonLoudness,differential:n.differential,sectionConfidence:n.sectionConfidence,conformedBegin:n.comformedBegin,conformedEnd:n.comformedEnd,oBegin:n.oBegin,oEnd:n.oEnd,sectionColor:a.sectionColor,goodForMix:a.goodForMix,isBest:a.isBest,sizeComparison:a.sizeComparison,is32:a.is32}}),e.props.otherReady&&e.waveform.getCurrentTime()/e.waveform.getDuration()>.4&&(a.sectionType===N&&e.numDropsPassed>0||a.sectionType===P||e.waveform.getCurrentTime()/e.waveform.getDuration()>.7)&&e.props.playOtherTrack()):e.props.hitBar()})),this.waveform.on("ready",(function(t){e.state.audioCtx.resume(),e.waveform.isPlaying()||(e.playPause(),e.props.prepared()),e.waveform.setVolume(.01)})),this.waveform.on("play",(function(t){if(e.props.play)if(Q)console.log("was a master pause"),Q=!1;else{e.waveform.setVolume(.01);var a="Fading in "+e.props.deckName;e.props.newThought(a,ge.MIX),e.fadeInSong()}}))}},{key:"takeOutSong",value:function(){this.fadeOutSong();var e="Fading out "+this.props.deckName;this.props.newThought(e,ge.MIX)}},{key:"playPause",value:function(){"suspended"===this.state.audioCtx.state&&this.state.audioCtx.resume(),this.waveform.play(this.state.startingPos),this.state.playing!==this.waveform.isPlaying()&&this.setState({playing:this.waveform.isPlaying()})}},{key:"changeFilter",value:function(e){if(e<=14e3)this.state.audioSettings.lowpassF=e,this.state.lowpassNode.frequency.value=e;else if(e>=2e4){var t=e-2e4;this.state.audioSettings.highpassF=t,this.state.highpassNode.frequency.value=this.state.audioSettings.highpassF}else this.state.audioSettings.lowpassF=3e4,this.state.lowpassNode.frequency.value=this.state.audioSettings.lowpassF,this.state.audioSettings.highpassF=0,this.state.highpassNode.frequency.value=this.state.audioSettings.highpassF}},{key:"changeGain",value:function(e){this.setState({audioSettings:{gain:(e/100).toPrecision(2)}})}},{key:"handlePosChange",value:function(e){this.setState({pos:e})}},{key:"fadeOutSong",value:function(){var e=this;this.fadingOut=!0,this.waveform.setVolume(Z(this.waveform.getVolume(),0,Math.min(this.waveform.getVolume()/3),.1,this.props.deckName)),this.state.lowpassNode.frequency.value-=this.state.lowpassNode.frequency.value/10,this.waveform.getVolume()<.2&&this.waveform.setVolume(this.waveform.getVolume()-.03),this.waveform.getVolume()>.01?setTimeout((function(){e.fadeOutSong()}),1e3):(this.fadingOut=!1,this.waveform.setVolume(0),this.waveform.pause(),this.props.finished())}},{key:"fadeInSong",value:function(){var e=this;this.fadingIn=!0;var t=Z(this.waveform.getVolume(),this.props.recommendedVolume,Math.min(this.waveform.getVolume()/4),.03,this.props.deckName);isFinite(t)&&(t>=this.props.recommendedVolume?this.waveform.setVolume(this.props.recommendedVolume):this.waveform.setVolume(t)),this.waveform.getVolume()<this.props.recommendedVolume-.05?setTimeout((function(){e.fadeInSong()}),1e3):(this.fadingIn=!1,this.waveform.setVolume(this.props.recommendedVolume),this.props.removeOther())}},{key:"skipSong",value:function(){this.takeOutSong(),this.props.playOtherTrack()}},{key:"render",value:function(){var e=this;return s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{className:"deck"},s.a.createElement("img",{src:this.props.songImage.url,alt:""}),s.a.createElement("div",{className:"deck-content"},s.a.createElement("div",{className:"deck-text"},""!==this.props.songName&&s.a.createElement("h2",null,this.props.songName),""!==this.props.songName&&s.a.createElement("h3",null,this.props.songArtist)),s.a.createElement("div",{className:"deck-text"},s.a.createElement("h4",null,this.props.bpm," BPM"),s.a.createElement("button",{onClick:function(){return e.skipSong()}},"SKIP SONG")),s.a.createElement("div",{id:"".concat(this.props.waveformID)}))))}}]),a}(n.Component);function Z(e,t,a,n){return(1-a)*e+a*t}a(22);var $=0,ee=0,te=0,ae=0,ne=9,se=9;function re(e){var t=e.newThought,a=e.masterPlay,r=Object(n.useState)(),o=Object(l.a)(r,2),i=o[0],c=o[1],u=Object(n.useState)(""),f=Object(l.a)(u,2),p=f[0],h=f[1],d=Object(n.useState)(""),m=Object(l.a)(d,2),g=m[0],v=m[1],b=Object(n.useState)(0),y=Object(l.a)(b,2),w=y[0],k=y[1],O=Object(n.useState)(0),S=Object(l.a)(O,2),E=S[0],j=S[1],x=Object(n.useState)(1),N=Object(l.a)(x,2),A=N[0],P=N[1],T=Object(n.useState)(1),C=Object(l.a)(T,2),I=C[0],F=C[1],D=Object(n.useState)(!1),R=Object(l.a)(D,2),M=R[0],B=R[1],L=Object(n.useState)(!1),V=Object(l.a)(L,2),U=V[0],z=V[1],q=Object(n.useState)(!1),G=Object(l.a)(q,2),W=G[0],H=G[1],X=Object(n.useState)(!1),K=Object(l.a)(X,2),J=K[0],Y=K[1],Q=Object(n.useState)(!1),Z=Object(l.a)(Q,2),re=Z[0],oe=Z[1],ie=Object(n.useState)(!1),ce=Object(l.a)(ie,2),ue=ce[0],le=ce[1],pe=Object(n.useState)(0),he=Object(l.a)(pe,2),me=he[0],ge=he[1],ve=Object(n.useState)(0),be=Object(l.a)(ve,2),ye=be[0],we=be[1],ke=Object(n.useState)(1),Oe=Object(l.a)(ke,2),Se=(Oe[0],Oe[1]),Ee=Object(n.useState)(1),je=Object(l.a)(Ee,2),xe=(je[0],je[1]);function Ne(){var e=de();if(B(!1),oe(!1),H(!1),null!==e){e.songAnalysis.analysis?console.log("CASE B",e):console.log("CASE A",e),k(Math.round(e.songAnalysis.analysis.tempo));var a=(e.songAnalysis.analysis.loudness/-10).toPrecision(5);if(console.log("DECK A NEW VOLUME >>>>>>>>>>>>>>>>",a),Se(a),""===g)P(1);else if(0!==E){var n=(E/e.songAnalysis.analysis.tempo).toPrecision(5);P(n)}else P(1);var s="Put "+e.songName+" on Deck A";t(s),h(e)}}function Ae(){var e=de();if(z(!1),le(!1),Y(!1),null!==e){e.songAnalysis.analysis?console.log("CASE B",e):console.log("CASE A",e),j(Math.round(e.songAnalysis.analysis.tempo));var a=(e.songAnalysis.analysis.loudness/-10).toPrecision(5);if(xe(a),""===p)F(1);else if(0!==w){var n=(w/Math.round(e.songAnalysis.analysis.tempo)).toPrecision(5);F(n)}else F(1);var s="Put "+e.songName+" on Deck B";t(s),v(e)}else console.log("[WARNING] new song was null")}function Pe(){M||(B(!0),ue||oe(!0))}function Te(){U||(z(!0),re||le(!0))}return Object(n.useEffect)((function(){if(!i){var e=new AudioContext;c(e)}Math.random()>.5?(ne+=10)>=360&&(ne=0):(se+=10)>=360&&(se=0)})),Object(n.useEffect)((function(){null!==(fe[0]||null)?(console.log("next song in queue was not null"),0==w&&""==p?Ne():0==E&&""==g&&Ae()):console.log("got next song in queue to be null")})),s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{className:"djboard"},s.a.createElement("div",{className:"boardpanel",style:re?{boxShadow:"0 3px 100px hsla(".concat(ne,", 100%, 64%, 0.302)")}:{boxShadow:"0 0 0 hsla(".concat(ne,", 100%, 64%, 0.302)")}},s.a.createElement("h3",null,"DECK A"),""!==p&&s.a.createElement(_,{thisSong:p.songURL,songName:p.songName,songArtist:p.songArtists[0].name,songImage:p.trackImage,songAnalysis:p.songAnalysis,playbackRate:A,prepared:Pe,play:re,startTime:0,playOtherTrack:function(){U&&(le(!0),z(!1),0===$&&($=2,ee=1))},hitBar:function(){te=i.currentTime,ue&&ge(ae-te)},offset:me,deckName:"Deck A",finished:function(){ee=2,F(1),Ne()},recommendedVolume:1,shouldSync:1!==ee,otherReady:Te,waveformID:"waveformA",bpm:w,newThought:t,shouldRemove:W,removeOther:function(){ue&&Y(!0)},otherPlaying:ue,masterPlay:a})),s.a.createElement("div",{className:"boardpanel",style:ue?{boxShadow:"0 3px 100px hsla(".concat(se,", 100%, 64%, 0.302)")}:{boxShadow:"0 0 0 hsla(".concat(se,", 100%, 64%, 0.302)")}},s.a.createElement("h3",{style:{textAlign:"right"}},"DECK B"),""!==g&&s.a.createElement(_,{thisSong:g.songURL,songName:g.songName,songArtist:g.songArtists[0].name,songImage:g.trackImage,songAnalysis:g.songAnalysis,playbackRate:I,prepared:Te,play:ue,startTime:0,playOtherTrack:function(){M&&(oe(!0),B(!1),0===$&&($=1,ee=1))},hitBar:function(){ae=i.currentTime,re&&we(te-ae)},offset:ye,deckName:"Deck B",finished:function(){ee=1,P(1),Ae()},recommendedVolume:1,shouldSync:2!==ee,otherReady:Pe,waveformID:"waveformB",bpm:E,newThought:t,shouldRemove:J,removeOther:function(){re&&H(!0)},otherPlaying:re,masterPlay:a}))))}var oe=function(e){return s.a.createElement(s.a.Fragment,null,0!==e.items.length&&s.a.createElement("div",{className:"queue-header"},s.a.createElement("h2",null,"TRACKLIST"),s.a.createElement("div",{className:"queue",style:{flexBasis:"content",flexGrow:1}},e.items.map((function(e,t){return s.a.createElement("div",{className:"entry",key:e.id,style:{flexGrow:1}},s.a.createElement("p",{key:e.id+"text"},e.body.songName))})))))},ie=a(28);function ce(e){var t=e.decisions,a=e.mixType,n=function(e){var t="#7f7b80";switch(e){case ge.SUCCESS:t="#48e26f";break;case ge.FAILURE:t="#e24848";break;case ge.MIX:t="tomato"}return t};return s.a.createElement("div",{className:"queue-header",style:{flexGrow:1}},s.a.createElement("h2",null,"MIXBOT BRAIN // ",a&&a),s.a.createElement("div",{className:"queue"},t.map((function(e){return s.a.createElement("div",{key:Object(ie.v4)()},e.display&&s.a.createElement("div",{className:"entry"},s.a.createElement("p",{style:{color:"".concat(n(e.type))}},e.body)))}))))}function ue(e){var t=e.hitPause,a=Object(n.useState)(!1),r=Object(l.a)(a,2),o=r[0],i=r[1];return s.a.createElement("div",{className:"queue-header",style:{flexGrow:1}},s.a.createElement("h2",null,"MIX SETTINGS"),s.a.createElement("div",{className:"queue"},s.a.createElement("div",{className:"entry"},s.a.createElement("button",{onClick:function(){i(t())}},o?"PLAY":"PAUSE"),s.a.createElement("p",null,"Mix Lengths (WIP)"),s.a.createElement("p",null,"Master Volume (WIP)"),s.a.createElement("p",null,"Current Mix (WIP)"))))}var le=[],fe=[],pe=[];function he(e){var t,a=Object(w.a)(le);try{for(a.s();!(t=a.n()).done;){if(t.value.songID===e)return!0}}catch(n){a.e(n)}finally{a.f()}return!1}function de(){var e=null;return 0!==fe.length&&(e=fe[0].body,pe.push(e),fe.shift()),e}function me(){return le.length}var ge={NEUTRAL:1,SUCCESS:2,FAILURE:3,MIX:4},ve=null;function be(){var e=Object(n.useState)([]),t=Object(l.a)(e,2),a=t[0],r=t[1],o=Object(n.useState)(!1),i=Object(l.a)(o,2),f=i[0],p=i[1],h=Object(n.useState)(!0),d=Object(l.a)(h,2),m=d[0],g=d[1];function v(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ge.NEUTRAL,n=!0;a.length>0&&a[0].body===e&&(n=!1),r([{id:"THOUGHT-"+a.length,body:e,type:t,display:n}].concat(Object(y.a)(a)))}function b(){return(b=Object(u.a)(c.a.mark((function e(t,a,n,s,r,o,i,u,l){var f,p,h;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("Called addToQueue for",t),!he(i)){e.next=4;break}return console.log(t," was already in tracklist!"),e.abrupt("return");case 4:"NOTFOUND"!==r?l||(console.log("Not in db yet, adding it..."),f=[],a.forEach((function(e){return f.push(e.name)})),{songID:i,videoID:u,name:t,artists:f,duration:n}):console.log("analysis was not found!"),p={songName:t,songArtists:a,duration_ms:n,songURL:s,songAnalysis:r,trackImage:o},console.log("added new song:",l),h={id:"tracklist"+le.length,body:p,songID:i},console.log("packaged song"),le.push(h),fe.push(h),console.log("pushed to tracklist and upcoming songs"),v("Added ".concat(t," to the tracklist"),ge.NEUTRAL),console.log("reached end of function");case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{className:"mixbot-body"},s.a.createElement(re,{newThought:v,masterPlay:m}),s.a.createElement("div",{className:"mixbot-dropdowns"},s.a.createElement(ce,{decisions:a,mixType:ve}),s.a.createElement(oe,{items:le}),s.a.createElement(ue,{hitPause:function(){return console.log("hit master play"),g(!m),m}}))),s.a.createElement("div",{style:{display:f?"none":"inherit"}},s.a.createElement(z,{addToQueue:function(e,t,a,n,s,r,o,i,c){return b.apply(this,arguments)},addMoreSongs:fe.length<1,newThought:v,mixChosen:function(e){v("Selected "+e+", beginning mix",ge.SUCCESS),ve=e,p(!0)}})))}var ye=function(){var e=Object(n.useState)(null),t=Object(l.a)(e,2),a=t[0],r=t[1],o=Object(n.useState)(null),i=Object(l.a)(o,2),p=i[0],h=i[1];return Object(n.useEffect)((function(){function e(){return(e=Object(u.a)(c.a.mark((function e(){var t,a,n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new b,console.log("Checking for update..."),e.next=4,t.checkForUpdate("0.1");case 4:a=e.sent,console.log("Checking for update... GOT",a),n="0.1"!==a.version,console.log(n),n?(h(a.newFeatures),r(!0)):r(!1);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[]),s.a.createElement("div",{className:"body"},s.a.createElement("div",{className:"title"},s.a.createElement("h1",null,"MIXBOT"),s.a.createElement("div",{className:"credits"},s.a.createElement("h3",null,"An Open Source project by Parssa Kyanzadeh"))),null!=a?a?s.a.createElement(f,{details:p,dontCare:function(){r(!1)}}):s.a.createElement(be,null):null)},we=function(e){e&&e instanceof Function&&a.e(3).then(a.bind(null,61)).then((function(t){var a=t.getCLS,n=t.getFID,s=t.getFCP,r=t.getLCP,o=t.getTTFB;a(e),n(e),s(e),r(e),o(e)}))};o.a.render(s.a.createElement(s.a.StrictMode,null,s.a.createElement(ye,null)),document.getElementById("root")),we()}},[[31,1,2]]]);
//# sourceMappingURL=main.cc8a8f4c.chunk.js.map